(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pagesNav-detail-detail"],{1176:function(t,e,n){"use strict";n.r(e);var a=n("db5f"),i=n("945d");for(var o in i)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(o);n("4966");var d=n("f0c5"),s=Object(d["a"])(i["default"],a["b"],a["c"],!1,null,"18b3c7d6",null,!1,a["a"],void 0);e["default"]=s.exports},4966:function(t,e,n){"use strict";var a=n("9788"),i=n.n(a);i.a},"8e6e":function(t,e,n){var a=n("24fb");e=a(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */uni-page-body[data-v-18b3c7d6],\n.container *[data-v-18b3c7d6],\nuni-view[data-v-18b3c7d6],\nuni-textarea[data-v-18b3c7d6],\nuni-button[data-v-18b3c7d6]{display:flex;box-sizing:border-box}uni-page-body[data-v-18b3c7d6]{height:100%;width:100%}.stop-responding[data-v-18b3c7d6]{font-size:14px;border-radius:3px;margin-bottom:15px;background-color:#f0b00a;color:#fff;width:90px;height:30px;line-height:30px;margin:0 auto;justify-content:center;margin-bottom:15px;cursor:pointer}.stop-responding[data-v-18b3c7d6]:hover{box-shadow:0 0 10px #aaa}.container[data-v-18b3c7d6]{height:100%;background-color:#fafafa;flex-direction:column;align-items:center;justify-content:center}.foot-box[data-v-18b3c7d6]{width:%?750?%;display:flex;flex-direction:column;padding:10px 0;background-color:#fff}.foot-box-content[data-v-18b3c7d6]{justify-content:space-around}.textarea-box[data-v-18b3c7d6]{padding:8px 10px;background-color:#f9f9f9;border-radius:5px}.textarea-box .textarea[data-v-18b3c7d6]{max-height:120px;font-size:14px;overflow:auto;width:%?450?%;font-size:14px}\n/*隐藏滚动条*/.textarea-box .textarea[data-v-18b3c7d6]::-webkit-scrollbar{width:0}.input-placeholder[data-v-18b3c7d6]{color:#bbb;line-height:18px}.trash[data-v-18b3c7d6],\n.send[data-v-18b3c7d6]{width:50px;height:30px;justify-content:center;align-items:center;flex-shrink:0}.trash[data-v-18b3c7d6]{width:%?30?%;margin-left:%?10?%}.menu[data-v-18b3c7d6]{justify-content:center;align-items:center;flex-shrink:0}.menu-item[data-v-18b3c7d6]{width:%?30?%;margin:0 %?10?%}.send[data-v-18b3c7d6]{color:#fff;border-radius:4px;display:flex;margin:0;padding:0;font-size:14px;margin-right:%?20?%}.send[data-v-18b3c7d6]::after{display:none}.msg-list[data-v-18b3c7d6]{height:0;flex:1;width:%?750?%}.noData[data-v-18b3c7d6]{margin-top:15px;text-align:center;width:%?750?%;color:#aaa;font-size:12px;justify-content:center}.open-ad-btn-box[data-v-18b3c7d6]{justify-content:center;margin:10px 0}.tip-ai-ing[data-v-18b3c7d6]{align-items:center;flex-direction:column;font-size:14px;color:#919396;padding:15px 0}.uni-link[data-v-18b3c7d6]{margin-left:5px;line-height:20px}@media screen and (min-width:650px){.foot-box[data-v-18b3c7d6]{border-top:solid 1px #dde0e2}.container[data-v-18b3c7d6], .container *[data-v-18b3c7d6]{max-width:950px}.container[data-v-18b3c7d6]{box-shadow:0 0 5px #e0e1e7;height:calc(100vh - 44px);margin:22px auto;border-radius:10px;overflow:hidden;background-color:#fafafa}uni-page-body[data-v-18b3c7d6]{background-color:#efefef}body.?%PAGE?%[data-v-18b3c7d6]{background-color:#efefef}.container .header[data-v-18b3c7d6]{height:44px;line-height:44px;border-bottom:1px solid #f0f0f0;width:100vw;justify-content:center;font-weight:500}.content[data-v-18b3c7d6]{background-color:#f9f9f9;position:relative;max-width:90%}.foot-box[data-v-18b3c7d6],\n  .foot-box-content[data-v-18b3c7d6],\n  .msg-list[data-v-18b3c7d6],\n  .msg-item[data-v-18b3c7d6],\n  .noData[data-v-18b3c7d6],\n  .textarea-box[data-v-18b3c7d6],\n  .textarea[data-v-18b3c7d6],\n  textarea-box[data-v-18b3c7d6]{width:100%!important}.textarea-box[data-v-18b3c7d6],\n  .textarea[data-v-18b3c7d6],\n  uni-textarea[data-v-18b3c7d6],\n  textarea-box[data-v-18b3c7d6]{height:120px}.foot-box[data-v-18b3c7d6],\n  .textarea-box[data-v-18b3c7d6]{background-color:#fff}.foot-box-content[data-v-18b3c7d6]{flex-direction:column;justify-content:center;align-items:flex-end;padding-bottom:0}.pc-menu[data-v-18b3c7d6]{padding:0 10px}.pc-menu-item[data-v-18b3c7d6]{height:20px;justify-content:center;align-items:center;align-content:center;display:flex;margin-right:10px;cursor:pointer}.pc-trash[data-v-18b3c7d6]{opacity:.8}.pc-trash uni-image[data-v-18b3c7d6]{height:15px}.send-btn-box .send-btn-tip[data-v-18b3c7d6]{color:#919396;margin-right:8px;font-size:12px;line-height:28px}}.retries-box[data-v-18b3c7d6]{justify-content:center;align-items:center;font-size:12px;color:#d2071b}.retries-icon[data-v-18b3c7d6]{margin-top:1px;margin-left:5px}',""]),t.exports=e},"945d":function(t,e,n){"use strict";n.r(e);var a=n("c960"),i=n.n(a);for(var o in a)["default"].indexOf(o)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(o);e["default"]=i.a},9788:function(t,e,n){var a=n("8e6e");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=n("4f06").default;i("28b33620",a,!0,{sourceMap:!1,shadowMode:!1})},c960:function(t,e,n){"use strict";(function(t){n("7a82");var a=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("c7eb")),o=a(n("1da1"));n("d3b7"),n("fb6a"),n("a434");var d=a(n("8df1")),s=[];s.clear=function(){s.forEach((function(t){return t.abort()})),s.slice(0,s.length)};var c=d.default.adpid,r={data:function(){return{scrollIntoView:"",msgList:[],requestState:0,insufficientScore:!1,content:"",sseIndex:0,enableStream:!0,isWidescreen:!1,adpid:c,keyboardHeight:0,timerange:[]}},computed:{placeholderText:function(){return window.innerWidth>960?"请输入内容，ctrl + enter 发送":"请输入想提问的内容"},NODE_ENV:function(){return"production"},footBoxPaddingBottom:function(){return(this.keyboardHeight||10)+"px"}},watch:{insufficientScore:function(t){uni.setStorage({key:"uni-ai-chat-insufficientScore",data:t})}},mounted:function(){var e=this;return(0,o.default)((0,i.default)().mark((function n(){var a,o;return(0,i.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(e.adpid&&t.getCurrentUserInfo().tokenExpired>Date.now())){n.next=6;break}return a=t.databaseForJQL(),n.next=4,a.collection("uni-id-users").where({_id:t.getCurrentUserInfo().uid}).field("score").get();case 4:o=n.sent,console.log("当前用户有多少积分:",o.data[0]&&o.data[0].score);case 6:case"end":return n.stop()}}),n)})))()},onLoad:function(e){uni.showLoading({title:"加载中"});var n=this.getTimeRange(e.dateStr);this.timerange=n;var a=uni.getStorageSync("uni-id-pages-userInfo"),i=t.database(),o=i.command,d=this;i.collection("history").where({userId:a._id,create_time:o.and([o.gte(n[0]),o.lte(n[1])]),isView:o.neq(!1)}).orderBy("create_time asc").get().then((function(t){var e=t.result.data;d.msgList=e,uni.hideLoading()}))},methods:{getTimeRange:function(t){var e=new Date(t);e.setHours(0,0,0,0);var n=e.getTime(),a=new Date(t);a.setHours(23,59,59,999);var i=a.getTime();return[n,i]},setHistory:function(){var t=this;uni.showModal({title:"确认要加载该历史记录吗？",content:"本操作不可撤销，会将旧历史内容清空",success:function(e){console.log(332,{e:e}),e.confirm&&(uni.setStorage({key:"uni-ai-msg",data:t.msgList}),uni.navigateTo({url:"/pages/chat/chat"}))}})},onAdClose:function(e){var n=this;if(console.log("onAdClose e.detail.isEnded",e.detail.isEnded),e.detail.isEnded){var a=0;uni.showLoading({mask:!0});var d=setInterval(function(){var e=(0,o.default)((0,i.default)().mark((function e(o){var s,c,r,l;return(0,i.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a++,s=t.database(),e.next=4,s.collection("uni-id-users").where('"_id" == $cloudEnv_uid').field("score").get();case 4:c=e.sent,r=c.result.data[0]||{},l=r.score,console.log("score",l),(l>0||a>5)&&(clearInterval(d),uni.hideLoading(),l>0&&(n.insufficientScore=!1,n.msgList.pop(),n.$nextTick((function(){uni.showToast({title:"积分余额:"+l,icon:"none"})}))));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3)}},showLastMsg:function(){var t=this;this.$nextTick((function(){t.scrollIntoView="last-msg-item",t.$nextTick((function(){t.scrollIntoView=""}))}))},clearAllMsg:function(e){var n=this;uni.showModal({title:"确认要删除聊天记录？",content:"本操作不可撤销",complete:function(e){if(e.confirm){var a=uni.getStorageSync("uni-id-pages-userInfo"),i=t.database(),o=i.command,d=n;i.collection("history").where({userId:a._id,create_time:o.and([o.gte(d.timerange[0]),o.lte(d.timerange[1])])}).update({isView:!1}).then((function(t){uni.showToast({title:"删除成功"}),d.msgList.splice(0,d.msgList.length)}))}}})}}};e.default=r}).call(this,n("a9ff")["default"])},db5f:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o})),n.d(e,"a",(function(){return a}));var a={uniAiMsg:n("e258").default,uniIcons:n("7a8a").default,llmConfig:n("7eea").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[t.isWidescreen?a("v-uni-view",{staticClass:"header"},[t._v("uni-ai-chat")]):t._e(),0===t.msgList.length?a("v-uni-text",{staticClass:"noData"},[t._v("没有对话记录")]):t._e(),a("v-uni-scroll-view",{staticClass:"msg-list",attrs:{"scroll-into-view":t.scrollIntoView,"scroll-y":"true","enable-flex":!0}},[t._l(t.msgList,(function(e,n){return a("uni-ai-msg",{key:n,ref:"msg",refInFor:!0,attrs:{msg:e,"show-cursor":n==t.msgList.length-1&&t.msgList.length%2===0&&t.sseIndex,isLastMsg:n==t.msgList.length-1}})})),t.adpid?a("v-uni-view",{staticClass:"open-ad-btn-box"},[a("v-uni-text",{staticStyle:{color:"red"}},[t._v('默认不启用广告组件(被注释)，如需使用，请"去掉注释"(“重新运行”后生效)\n\t\t\t\t位置：/pages/chat/chat.vue 第30行，或全局搜索 uni-ad-rewarded-video')])],1):t._e(),a("v-uni-view",{staticStyle:{height:"1px"},attrs:{id:"last-msg-item"}})],2),a("v-uni-view",{staticClass:"foot-box",style:{"padding-bottom":t.footBoxPaddingBottom}},[t.isWidescreen?a("v-uni-view",{staticClass:"pc-menu"},[a("v-uni-view",{staticClass:"pc-trash pc-menu-item",attrs:{title:"删除"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearAllMsg.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("9459"),mode:"heightFix"}})],1),a("uni-icons",{staticClass:"menu-item",attrs:{color:"#555",size:"20px",type:"chatbubble-filled"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setHistory.apply(void 0,arguments)}}})],1):t._e(),a("v-uni-view",{staticClass:"foot-box-content"},[t.isWidescreen?t._e():a("v-uni-view",{staticClass:"menu"},[a("uni-icons",{staticClass:"menu-item",attrs:{type:"trash",size:"24",color:"#888"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearAllMsg.apply(void 0,arguments)}}}),a("uni-icons",{staticClass:"menu-item",attrs:{color:"#555",size:"20px",type:"chatbubble-filled"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setHistory.apply(void 0,arguments)}}})],1),a("v-uni-view",{staticClass:"textarea-box"},[a("v-uni-textarea",{staticClass:"textarea",attrs:{disabled:!0,"cursor-spacing":15,"auto-height":!t.isWidescreen,placeholder:t.placeholderText,maxlength:-1,"adjust-position":!1,"disable-default-padding":!1,"placeholder-class":"input-placeholder"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),a("v-uni-view",{staticClass:"send-btn-box",attrs:{title:t.msgList.length&&t.msgList.length%2!==0?"ai正在回复中不能发送":""}},[t.isWidescreen?a("v-uni-text",{staticClass:"send-btn-tip"},[t._v("↵ 发送 / shift + ↵ 换行")]):t._e(),a("v-uni-button",{staticClass:"send",attrs:{disabled:!0,type:"primary"}},[t._v("发送")])],1)],1)],1),a("llm-config",{ref:"llm-config"})],1)},o=[]}}]);