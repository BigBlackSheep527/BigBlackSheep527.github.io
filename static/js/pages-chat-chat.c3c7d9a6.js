(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-chat"],{"05d1":function(t,e,n){var a=n("24fb");e=a(!1),e.push([t.i,'@charset "UTF-8";\n/**\n * 这里是uni-app内置的常用样式变量\n *\n * uni-app 官方扩展插件及插件市场（https://ext.dcloud.net.cn）上很多三方插件均使用了这些样式变量\n * 如果你是插件开发者，建议你使用scss预处理，并在插件代码中直接使用这些变量（无需 import 这个文件），方便用户通过搭积木的方式开发整体风格一致的App\n *\n */\n/**\n * 如果你是App开发者（插件使用者），你可以通过修改这些变量来定制自己的插件主题，实现自定义主题功能\n *\n * 如果你的项目同样使用了scss预处理，你也可以直接在你的 scss 代码中使用如下变量，同时无需 import 这个文件\n */\n/* 颜色变量 */\n/* 行为相关颜色 */\n/* 文字基本颜色 */\n/* 背景颜色 */\n/* 边框颜色 */\n/* 尺寸变量 */\n/* 文字尺寸 */\n/* 图片尺寸 */\n/* Border Radius */\n/* 水平间距 */\n/* 垂直间距 */\n/* 透明度 */\n/* 文章场景相关 */uni-page-body[data-v-901d8a64],\n.container *[data-v-901d8a64],\nuni-view[data-v-901d8a64],\nuni-textarea[data-v-901d8a64],\nuni-button[data-v-901d8a64]{display:flex;box-sizing:border-box}uni-page-body[data-v-901d8a64]{height:100%;width:100%}.dots-container[data-v-901d8a64]{display:flex;align-items:center;margin-left:%?10?%}.dot[data-v-901d8a64]{width:5px;height:5px;border-radius:50%;background-color:#3d3d3d;opacity:0;margin-right:5px;-webkit-animation:dots-data-v-901d8a64 1.5s infinite;animation:dots-data-v-901d8a64 1.5s infinite}.dot[data-v-901d8a64]:nth-child(1){-webkit-animation-delay:0s;animation-delay:0s}.dot[data-v-901d8a64]:nth-child(2){-webkit-animation-delay:.5s;animation-delay:.5s}.dot[data-v-901d8a64]:nth-child(3){-webkit-animation-delay:1s;animation-delay:1s}@-webkit-keyframes dots-data-v-901d8a64{0%{opacity:0}50%{opacity:1}100%{opacity:0}}@keyframes dots-data-v-901d8a64{0%{opacity:0}50%{opacity:1}100%{opacity:0}}.buttonstyle[data-v-901d8a64]{border:solid 1px #d0d0d0;padding:%?20?%;text-align:center;display:flex;justify-content:center;font-size:%?32?%;margin-left:%?26?%;border-radius:%?10?%;width:95%;margin-top:%?20?%}.popup_style[data-v-901d8a64]{padding:%?60?% 0;display:block!important}.popup_style .title[data-v-901d8a64]{display:flex;justify-content:center;font-size:%?40?%;font-weight:600;margin-bottom:%?28?%}.popup_style .avatar[data-v-901d8a64]{width:25%;display:flex;flex-direction:column;justify-content:center;padding:10px 0;align-items:center}.popup_style .avatar_text[data-v-901d8a64]{margin-top:%?20?%;font-size:%?30?%;font-weight:400}.popup-content-function-icon[data-v-901d8a64]{padding:%?40?%;display:flex;justify-content:space-around}.stop-responding[data-v-901d8a64]{font-size:14px;border-radius:3px;margin-bottom:15px;background-color:#f0b00a;color:#fff;width:90px;height:30px;line-height:30px;margin:0 auto;justify-content:center;margin-bottom:15px;cursor:pointer}.stop-responding[data-v-901d8a64]:hover{box-shadow:0 0 10px #aaa}.container[data-v-901d8a64]{height:100%;background-color:#fafafa;flex-direction:column;align-items:center;justify-content:center}.hoverCick[data-v-901d8a64]{cursor:pointer}.foot-box[data-v-901d8a64]{width:%?750?%;display:flex;flex-direction:column;padding:10px 0;background-color:#fff}.foot-box-content[data-v-901d8a64]{justify-content:space-around}.textarea-box[data-v-901d8a64]{padding:8px 10px;background-color:#f9f9f9;border-radius:5px;width:95%}.textarea-box .textarea[data-v-901d8a64]{max-height:120px;font-size:14px;overflow:auto;width:%?450?%;font-size:14px}\n/*隐藏滚动条*/.textarea-box .textarea[data-v-901d8a64]::-webkit-scrollbar{width:0}.input-placeholder[data-v-901d8a64]{color:#bbb;line-height:18px}.trash[data-v-901d8a64],\n.send[data-v-901d8a64]{width:50px;height:30px;justify-content:center;align-items:center;flex-shrink:0}.trash[data-v-901d8a64]{width:%?30?%;margin-left:%?10?%}.menu[data-v-901d8a64]{justify-content:center;flex-shrink:0}.menu-item[data-v-901d8a64]{width:%?30?%;margin:0 %?10?%}.send[data-v-901d8a64]{color:#fff;border-radius:4px;display:flex;margin:0;padding:0;font-size:14px;margin-right:%?20?%}.send[data-v-901d8a64]::after{display:none}.msg-list[data-v-901d8a64]{height:0;flex:1;width:%?750?%}.noData[data-v-901d8a64]{margin-top:15px;text-align:center;width:%?750?%;color:#aaa;font-size:12px;justify-content:center}.open-ad-btn-box[data-v-901d8a64]{justify-content:center;margin:10px 0}.tip-ai-ing[data-v-901d8a64]{align-items:center;flex-direction:column;font-size:14px;color:#919396;padding:15px 0}.uni-link[data-v-901d8a64]{margin-left:5px;line-height:20px}@media screen and (max-width:649px){.send-btn-box[data-v-901d8a64]{display:flex!important;justify-content:center!important}._send[data-v-901d8a64]{margin:0!important}.textarea-box .textarea[data-v-901d8a64]{width:200px}}@media screen and (min-width:650px){.foot-box[data-v-901d8a64]{border-top:solid 1px #dde0e2}.container[data-v-901d8a64], .container *[data-v-901d8a64]{max-width:950px}.container[data-v-901d8a64]{box-shadow:0 0 5px #e0e1e7;height:calc(100vh - 44px);margin:22px auto;border-radius:10px;overflow:hidden;background-color:#fafafa}uni-page-body[data-v-901d8a64]{background-color:#efefef}body.?%PAGE?%[data-v-901d8a64]{background-color:#efefef}.container .header[data-v-901d8a64]{height:44px;line-height:44px;border-bottom:1px solid #f0f0f0;width:100vw;justify-content:center;font-weight:500}.content[data-v-901d8a64]{background-color:#f9f9f9;position:relative;max-width:90%}.foot-box[data-v-901d8a64],\n  .foot-box-content[data-v-901d8a64],\n  .msg-list[data-v-901d8a64],\n  .msg-item[data-v-901d8a64],\n  .noData[data-v-901d8a64],\n  .textarea-box[data-v-901d8a64],\n  .textarea[data-v-901d8a64],\n  textarea-box[data-v-901d8a64]{width:100%!important}.textarea-box[data-v-901d8a64],\n  .textarea[data-v-901d8a64],\n  uni-textarea[data-v-901d8a64],\n  textarea-box[data-v-901d8a64]{height:120px}.foot-box[data-v-901d8a64],\n  .textarea-box[data-v-901d8a64]{background-color:#fff}.foot-box-content[data-v-901d8a64]{flex-direction:column;justify-content:center;align-items:flex-end;padding-bottom:0}.pc-menu[data-v-901d8a64]{padding:0 10px;width:50%;display:flex;justify-content:space-around}.pc-menu-item[data-v-901d8a64]{height:20px;line-height:20px;justify-content:center;align-items:center;align-content:center;display:flex;cursor:pointer}.pc-trash[data-v-901d8a64]{opacity:.8}.pc-trash uni-image[data-v-901d8a64]{height:15px}.pc-trash-other uni-image[data-v-901d8a64]{height:20px}.send-btn-box .send-btn-tip[data-v-901d8a64]{color:#919396;margin-right:8px;font-size:12px;line-height:28px}}.retries-box[data-v-901d8a64]{justify-content:center;align-items:center;font-size:12px;color:#d2071b}.retries-icon[data-v-901d8a64]{margin-top:1px;margin-left:5px}\n/** 禁用标识 */',""]),t.exports=e},"351d":function(t,e,n){"use strict";var a=n("7bcb"),i=n.n(a);i.a},"38d0":function(t,e){t.exports="data:image/png;base64,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"},5516:function(t,e,n){t.exports=n.p+"static/img/key.efd4339f.png"},"58de":function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return s})),n.d(e,"a",(function(){return a}));var a={uniAiMsg:n("e258").default,uniIcons:n("7a8a").default,uniLink:n("55a1").default,uniPopup:n("97d8").default,llmConfig:n("7eea").default,providerConfig:n("fb2d").default,apikeyConfig:n("43fe").default},i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"container"},[t.isWidescreen?a("v-uni-view",{staticClass:"header"},[t._v("知心AI助手")]):t._e(),0===t.msgList.length?a("v-uni-text",{staticClass:"noData"},[t._v("没有对话记录")]):t._e(),a("v-uni-scroll-view",{staticClass:"msg-list",attrs:{"scroll-into-view":t.scrollIntoView,"scroll-y":"true","enable-flex":!0}},[t._l(t.msgList,(function(e,n){return a("uni-ai-msg",{key:n,ref:"msg",refInFor:!0,attrs:{msg:e,"show-cursor":n==t.msgList.length-1&&t.msgList.length%2===0&&t.sseIndex,isLastMsg:n==t.msgList.length-1},on:{changeAnswer:function(e){arguments[0]=e=t.$handleEvent(e),t.changeAnswer.apply(void 0,arguments)},removeMsg:function(e){arguments[0]=e=t.$handleEvent(e),t.removeMsg(n)}}})})),t.msgList.length%2!==0?[-100==t.requestState?a("v-uni-view",{staticClass:"retries-box"},[a("v-uni-text",[t._v("消息发送失败")]),a("uni-icons",{staticClass:"retries-icon",attrs:{color:"#d22",type:"refresh-filled"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.send.apply(void 0,arguments)}}})],1):t.msgList.length?a("v-uni-view",{staticClass:"tip-ai-ing"},[a("span",{staticStyle:{display:"flex"}},[a("span",[t._v("ai正在思考中")]),a("span",{staticClass:"dots-container"},[a("span",{staticClass:"dot"}),a("span",{staticClass:"dot"}),a("span",{staticClass:"dot"})])]),"development"!=t.NODE_ENV||t.enableStream?t._e():a("v-uni-view",[t._v("如需提速，请开通"),a("uni-link",{staticClass:"uni-link",attrs:{href:"https://uniapp.dcloud.net.cn/uniCloud/uni-ai-chat.html",text:"[流式响应]"}})],1)],1):t._e()]:t._e(),t.adpid?a("v-uni-view",{staticClass:"open-ad-btn-box"},[a("v-uni-text",{staticStyle:{color:"red"}},[t._v('默认不启用广告组件(被注释)，如需使用，请"去掉注释"(“重新运行”后生效)\n\t\t\t\t位置：/pages/chat/chat.vue 第30行，或全局搜索 uni-ad-rewarded-video')])],1):t._e(),t.sseIndex?a("v-uni-view",{staticClass:"stop-responding",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closeSseChannel.apply(void 0,arguments)}}},[t._v("▣ 停止响应")]):t._e(),a("v-uni-view",{staticStyle:{height:"1px"},attrs:{id:"last-msg-item"}})],2),a("v-uni-view",{staticClass:"foot-box",style:{"padding-bottom":t.footBoxPaddingBottom}},[t.isWidescreen?a("v-uni-view",{staticClass:"pc-menu"},[a("v-uni-view",{staticClass:"pc-trash pc-menu-item ",attrs:{title:"删除"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearAllMsg.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("9459"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other",attrs:{title:"首页"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.leave.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("732a"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other",attrs:{title:"记录"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.viewRecord.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("1a63"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other",attrs:{title:"个人中心"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toUser.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("bb7c"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other",attrs:{title:"模型"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setLLMprovider.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("b6cd"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other  ",attrs:{title:"运营商"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setLLMmodel.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("b25f"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other  ",attrs:{title:"钥匙"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setLLMapikey.apply(void 0,arguments)}}},[a("v-uni-image",{attrs:{src:n("5516"),mode:"heightFix"}})],1),a("v-uni-view",{staticClass:"pc-trash-other ",attrs:{title:"保存"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.save(!0)}}},[a("v-uni-image",{attrs:{src:n("38d0"),mode:"heightFix"}})],1)],1):t._e(),a("v-uni-view",{staticClass:"foot-box-content"},[t.isWidescreen?t._e():a("v-uni-view",{staticClass:"menu"},[a("uni-icons",{staticClass:"menu-item",attrs:{type:"trash",size:"30px",color:"#888"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.clearAllMsg.apply(void 0,arguments)}}})],1),t.isWidescreen?t._e():a("v-uni-view",{staticClass:"settings pc-menu-item",staticStyle:{margin:"0 20rpx","padding-top":"6rpx"},attrs:{title:"设置"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toggle.apply(void 0,arguments)}}},[a("uni-icons",{attrs:{color:"#555",size:"30px",type:"settings"}})],1),a("v-uni-view",{staticClass:"textarea-box"},[a("v-uni-textarea",{staticClass:"textarea",attrs:{"cursor-spacing":15,"auto-height":!t.isWidescreen,placeholder:t.placeholderText,maxlength:-1,"adjust-position":!1,"disable-default-padding":!1,"placeholder-class":"input-placeholder"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1),a("v-uni-view",{staticClass:"send-btn-box",attrs:{title:t.msgList.length&&t.msgList.length%2!==0?"ai正在回复中不能发送":""}},[t.isWidescreen?a("v-uni-text",{staticClass:"send-btn-tip"},[t._v("↵ 发送 / shift + ↵ 换行")]):t._e(),t.isHuiHua?a("v-uni-button",{staticClass:"send",attrs:{"open-type":"contact",type:"primary"}},[t._v("会话")]):a("v-uni-button",{staticClass:"send _send",attrs:{disabled:t.inputBoxDisabled||!t.content,type:"primary"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.beforeSend.apply(void 0,arguments)}}},[t._v("发送")])],1)],1),a("uni-popup",{ref:"functionicon",attrs:{"background-color":"#fff"}},[a("v-uni-view",{staticClass:"popup_style"},[a("v-uni-view",{staticClass:"title"},[t._v("功能")]),a("v-uni-view",[a("v-uni-view",{staticClass:"avatar",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.leave.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("732a")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("首页")])],1),a("v-uni-view",{staticClass:"avatar",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.toUser.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("bb7c")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("我的")])],1),a("v-uni-view",{staticClass:"avatar",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setLLMprovider.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("b25f")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("运营商")])],1),a("v-uni-view",{staticClass:"avatar",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setLLMmodel.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("b6cd")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("模型")])],1)],1),a("v-uni-view",[a("v-uni-view",{staticClass:"avatar",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.setLLMapikey.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("0eb0")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("APIKEY")])],1),a("v-uni-view",{staticClass:"avatar disabledIconStyle",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.viewRecord.apply(void 0,arguments)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("1a63")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("记录")])],1),a("v-uni-view",{staticClass:"avatar",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.save(!0)}}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("38d0")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("强制保存")])],1),a("v-uni-view",{staticClass:"avatar",staticStyle:{display:"none"}},[a("v-uni-image",{staticStyle:{width:"80rpx",height:"80rpx"},attrs:{src:n("0eb0")},on:{error:function(e){arguments[0]=e=t.$handleEvent(e),t.imageError.apply(void 0,arguments)}}}),a("v-uni-text",{staticClass:"avatar_text"},[t._v("运营商")])],1)],1),a("v-uni-view",{staticClass:"buttonstyle",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.closed.apply(void 0,arguments)}}},[t._v("取消")])],1)],1)],1),a("llm-config",{ref:"llm-config"}),a("provider-config",{ref:"provider-config"}),a("apikey-config",{ref:"apikey-config"})],1)},s=[]},"6e05":function(t,e,n){"use strict";(function(t){n("7a82");var a=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.coName,a=e.funName,s=e.param,o=e.success,c=e.fail,d=e.complete,l=e.config;if(!Array.isArray(s))throw new Error("param的值必须为数组");var u=new r({success:o,fail:c,complete:d}),f=t.importObject(n,l||{});return f[a].apply(f,(0,i.default)(s)).then((function(t){u.invoke("success",t)})).catch((function(t){u.invoke("fail",t)})).finally((function(t){u.invoke("complete",t)})),u},n("d9e2"),n("d401"),n("d3b7");var i=a(n("2909")),s=a(n("d4ec")),o=a(n("bee2")),r=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.success,a=e.fail,i=e.complete;(0,s.default)(this,t),this.status=0,this.callback={success:n,fail:a,complete:i}}return(0,o.default)(t,[{key:"invoke",value:function(t){if(0===this.status){for(var e=this.callback[t],n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];e&&e.apply(void 0,a)}}},{key:"abort",value:function(){this.status=1}}]),t}()}).call(this,n("a9ff")["default"])},7873:function(t,e,n){"use strict";n("7a82");var a=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0,n("fb6a");var i=a(n("d4ec")),s=a(n("bee2")),o=a(n("ade3")),r=function(){function t(e){(0,i.default)(this,t),(0,o.default)(this,"msgs",""),(0,o.default)(this,"sliceMsgIng",!1),this.$=e}return(0,s.default)(t,[{key:"addMsg",value:function(t){this.msgs+=t,!1===this.sliceMsgIng&&this.sliceMsg()}},{key:"sliceMsg",value:function(){var t=this;this.sliceMsgIng=!0;var e=this.msgs.slice(0,1);this.$.updateLastMsg((function(t){t.content+=e})),this.msgs=this.msgs.slice(1),this.msgs.length?setTimeout((function(){t.sliceMsg(t.msgs)}),30):this.sliceMsgIng=!1}}]),t}();e.default=r},"7a04":function(t,e,n){"use strict";n.r(e);var a=n("58de"),i=n("99e6");for(var s in i)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return i[t]}))}(s);n("351d");var o=n("f0c5"),r=Object(o["a"])(i["default"],a["b"],a["c"],!1,null,"901d8a64",null,!1,a["a"],void 0);e["default"]=r.exports},"7bcb":function(t,e,n){var a=n("05d1");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var i=n("4f06").default;i("2ba5957f",a,!0,{sourceMap:!1,shadowMode:!1})},"99e6":function(t,e,n){"use strict";n.r(e);var a=n("ad1c"),i=n.n(a);for(var s in a)["default"].indexOf(s)<0&&function(t){n.d(e,t,(function(){return a[t]}))}(s);e["default"]=i.a},ad1c:function(t,e,n){"use strict";(function(t){n("7a82");var a=n("4ea4").default;Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=a(n("5530")),s=a(n("53ca")),o=a(n("2909")),r=a(n("c7eb")),c=a(n("1da1"));n("d3b7"),n("fb6a"),n("caad"),n("a434"),n("14d9"),n("e9c4"),n("c740"),n("26e9"),n("4de4"),n("d81d"),n("3ca3"),n("ddb0"),n("2532");var d=a(n("8df1")),l=a(n("6e05")),u=a(n("7873")),f=[];f.clear=function(){f.forEach((function(t){return t.abort()})),f.slice(0,f.length)};var p=d.default.adpid,v=!1,h={data:function(){return{showUser:!0,scrollIntoView:"",msgList:[],requestState:0,insufficientScore:!1,content:"",sseIndex:0,enableStream:!0,isWidescreen:!1,adpid:p,keyboardHeight:0,isHuiHua:!1,msglistNum:16,textareawidth:"200px",llmModel:!1,provider:!1,apikey:!1}},computed:{inputBoxDisabled:function(){return 0!==this.sseIndex||!(!this.msgList.length||this.msgList.length%2===0)},placeholderText:function(){return window.innerWidth>960?"请输入内容，ctrl + enter 发送":"请输入想提问的内容"},NODE_ENV:function(){return"production"},footBoxPaddingBottom:function(){return(this.keyboardHeight||10)+"px"}},watch:{msgList:{handler:function(t){uni.setStorage({key:"uni-ai-msg",data:t})},deep:!0},insufficientScore:function(t){uni.setStorage({key:"uni-ai-chat-insufficientScore",data:t})},llmModel:function(t){var e="知心AI助手";t&&(e+=" (".concat(t,")")),this.isWidescreen&&(document.querySelector(".header").innerText=e),uni.setStorage({key:"uni-ai-chat-llmModel",data:t})},provider:function(t){uni.setStorage({key:"uni-ai-chat-provider",data:t})},apikey:function(t){uni.setStorage({key:"uni-ai-chat-apikey",data:t})}},beforeMount:function(){var t=this;uni.createMediaQueryObserver(this).observe({minWidth:650},(function(e){t.isWidescreen=e}))},onLoad:function(t){this.content=(null===t||void 0===t?void 0:t.content)||""},mounted:function(){var e=this;return(0,c.default)((0,r.default)().mark((function n(){var a,i,s,o,c,d,l;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!(e.adpid&&t.getCurrentUserInfo().tokenExpired>Date.now())){n.next=6;break}return a=t.databaseForJQL(),n.next=4,a.collection("uni-id-users").where({_id:t.getCurrentUserInfo().uid}).field("score").get();case 4:i=n.sent,console.log("当前用户有多少积分:",i.data[0]&&i.data[0].score);case 6:e.msgList=uni.getStorageSync("uni-ai-msg")||[],e.llmModel=uni.getStorageSync("uni-ai-chat-llmModel"),e.provider=uni.getStorageSync("uni-ai-chat-provider"),e.apikey=uni.getStorageSync("uni-ai-chat-apikey"),e.insufficientScore=uni.getStorageSync("uni-ai-chat-insufficientScore")||!1,s=e.msgList.length,s&&(o=e.msgList[s-1],o.isAi||e.send()),e.$nextTick((function(){e.showLastMsg()})),c=!1,d=document.querySelector(".textarea-box textarea"),d&&(d.onkeydown=function(t){[16,17,18,93].includes(t.keyCode)&&(c=!0),13!=t.keyCode||c||(t.preventDefault(),setTimeout((function(){e.beforeSend()}),300))},d.onkeyup=function(t){[16,17,18,93].includes(t.keyCode)&&(c=!1)},l=window.innerHeight,"ios"==uni.getSystemInfoSync().platform?(d.addEventListener("focus",(function(){var t=setInterval((function(){window.innerHeight!==l&&(clearInterval(t),document.querySelector(".container").style.height=window.innerHeight+"px",window.scrollTo(0,0),this.showLastMsg())}),1)})),d.addEventListener("blur",(function(){document.querySelector(".container").style.height=l+"px"}))):window.addEventListener("resize",(function(t){e.showLastMsg()})));case 17:case"end":return n.stop()}}),n)})))()},methods:{leave:function(){uni.navigateTo({url:"/pages/index/index"})},viewRecord:function(){uni.navigateTo({url:"/pages/list/list"})},toUser:function(){uni.navigateTo({url:"/uni_modules/uni-id-pages/pages/userinfo/userinfo"})},setLLMmodel:function(){var t=this;this.$refs["llm-config"].open((function(e){t.llmModel=e,t.$refs.functionicon.close()}))},toggle:function(){this.$refs.functionicon.open("bottom")},closed:function(){this.$refs.functionicon.close()},setLLMprovider:function(){var t=this;this.$refs["provider-config"].open((function(e){t.msgList=[],t.provider=e,uni.setStorage({key:"uni-ai-chat-provider",data:e}),t.$refs.functionicon.close()}))},setLLMapikey:function(){var t=this;this.$refs["apikey-config"].open((function(e){t.msgList=[],t.apikey=e,uni.setStorage({key:"uni-ai-chat-apikey",data:e}),t.$refs.functionicon.close()}))},checkIsOpenPush:function(){var t=this;return(0,c.default)((0,r.default)().mark((function e(){return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,uni.getPushClientId();case 3:t.checkIsOpenPush=function(){},e.next=9;break;case 6:e.prev=6,e.t0=e["catch"](0),t.enableStream=!1;case 9:case"end":return e.stop()}}),e,null,[[0,6]])})))()},updateLastMsg:function(t){var e=this.msgList.length;if(0!==e){var n=this.msgList[e-1];if("function"==typeof t){var a=t;a(n)}else{var i=Array.prototype.slice.call(arguments),s=i[0],o=i[1],r=void 0!==o&&o;n=r?s:Object.assign(n,s)}this.msgList.splice(e-1,1,n)}},onAdClose:function(e){var n=this;if(console.log("onAdClose e.detail.isEnded",e.detail.isEnded),e.detail.isEnded){var a=0;uni.showLoading({mask:!0});var i=setInterval(function(){var e=(0,c.default)((0,r.default)().mark((function e(s){var o,c,d,l;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return a++,o=t.database(),e.next=4,o.collection("uni-id-users").where('"_id" == $cloudEnv_uid').field("score").get();case 4:c=e.sent,d=c.result.data[0]||{},l=d.score,console.log("score",l),(l>0||a>5)&&(clearInterval(i),uni.hideLoading(),l>0&&(n.insufficientScore=!1,n.msgList.pop(),n.$nextTick((function(){n.send(),uni.showToast({title:"积分余额:"+l,icon:"none"})}))));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),2e3)}},changeAnswer:function(){var t=this;return(0,c.default)((0,r.default)().mark((function e(){return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.sseIndex&&t.closeSseChannel(),t.msgList.pop(),t.updateLastMsg({illegal:!1}),t.insufficientScore=!1,t.send();case 5:case"end":return e.stop()}}),e)})))()},removeMsg:function(t){this.sseIndex&&this.closeSseChannel(),this.msgList[t].isAi&&(t-=1),this.msgList.splice(t,2)},beforeSend:function(){var t=this;return(0,c.default)((0,r.default)().mark((function e(){var n;return(0,r.default)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!t.inputBoxDisabled){e.next=2;break}return e.abrupt("return",uni.showToast({title:"ai正在回复中不能发送",icon:"none"}));case 2:if(!t.adpid){e.next=6;break}if(n=uni.getStorageSync("uni_id_token"),n){e.next=6;break}return e.abrupt("return",uni.showModal({content:"启用激励视频，客户端需登录并启用安全网络",showCancel:!1,confirmText:"查看详情",complete:function(){window.open("https://uniapp.dcloud.net.cn/uniCloud/uni-ai-chat.html#ad")}}));case 6:if(t.content){e.next=8;break}return e.abrupt("return",uni.showToast({title:"内容不能为空",icon:"none"}));case 8:t.msgList.push({isAi:!1,content:t.content,create_time:Date.now()}),t.showLastMsg(),t.$nextTick((function(){t.content=""})),t.send();case 12:case"end":return e.stop()}}),e)})))()},send:function(){var e=this;return(0,c.default)((0,r.default)().mark((function n(){var a,i,c,d,p,h,g,m,x;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e.requestState=0,f.clear(),e.afterChatCompletion&&e.afterChatCompletion.clear&&e.afterChatCompletion.clear(),a=[],i=JSON.parse(JSON.stringify(e.msgList)),c=JSON.parse(JSON.stringify(i.slice(-e.msglistNum))),d=(0,o.default)(c).reverse().findIndex((function(t){return t.summarize})),-1!=d?(p=c.length-d-1,c[p].content=c[p].summarize,c=c.splice(p)):c=c.splice(-10),c=c.filter((function(t){return!t.illegal})),a=c.map((function(t){var e="user";return t.isAi&&(e=t.summarize?"system":"assistant"),{content:t.content,role:e}})),console.log("send to ai messages:",a),n.next=13,e.checkIsOpenPush();case 13:if(!e.enableStream){n.next=21;break}return v=new t.SSEChannel,m=new u.default(e),v.on("message",(function(t){0===e.sseIndex?e.msgList.push({isAi:!0,content:t,create_time:Date.now()}):m.addMsg(t),e.showLastMsg(),e.sseIndex++})),v.on("end",(function(t){if(console.log("sse 结束",t),t&&"object"==(0,s.default)(t)&&t.errCode){if(60004==t.errCode){var n=e.msgList.length;n%2&&(e.msgList.push({isAi:!0,content:"内容涉及敏感",illegal:!0,create_time:Date.now()}),n+=1),e.msgList[n-2].illegal=!0,e.msgList[n-1].illegal=!0,e.msgList[n-1].content="内容涉及敏感"}else(function(t){0===e.sseIndex?e.msgList.push({isAi:!0,content:t,create_time:Date.now()}):e.updateLastMsg((function(e){e.content+=t})),e.showLastMsg()})(t.errMsg)}h()})),n.next=20,v.open();case 20:(function t(e){t.clear=function(){t.clear.sse&&t.clear.sse(),t.clear.request&&t.clear.request()},Promise.all([new Promise((function(e,n){h=e,t.clear.sse=n})),new Promise((function(e,n){g=e,t.clear.request=n}))]).then((function(t){v.close(),e.sseIndex=0})).catch((function(t){})),e.afterChatCompletion=t})(e);case 21:x=(0,l.default)({coName:"uni-ai-chat",funName:"send",param:[{messages:a,sseChannel:v,llmModel:e.llmModel,provider:e.provider,userApiKey:e.apikey}],config:{customUI:!0},success:function(t){if(e.requestState=100,t.data){var n=t;"积分不足，请看完激励视频广告后再试"==t.data.reply&&(n.data.reply="积分不足!请点击右边回话，联系小程序作者增加体验积分",e.isHuiHua=!0);var a=n.data,i=a.reply,s=a.summarize,o=a.insufficientScore,r=a.illegal;if(0!=e.enableStream||i||(r=!0,i="内容涉及敏感"),(0==e.enableStream||0==e.sseIndex&&(r||o))&&e.msgList.push({create_time:Date.now(),isAi:!0,content:i,illegal:r}),o&&(e.insufficientScore=!0),s){console.log(" 拿到总结",s);var c=e.msgList.length;c-=c%2===0?2:1,c<0&&(c=0);var d=e.msgList[c];d.summarize=s,e.msgList.splice(c,1,d)}r&&(console.error("内容涉及敏感"),e.updateLastMsg({illegal:!0}))}},complete:function(t){e.enableStream&&g(),e.$nextTick((function(){e.showLastMsg()}))},fail:function(t){console.error(t),e.requestState=-100,uni.showModal({content:JSON.stringify(t.message),showCancel:!1}),e.enableStream&&h()}}),f.push(x);case 23:case"end":return n.stop()}}),n)})))()},closeSseChannel:function(){v&&(v.close(),v=!1),f.clear(),this.sseIndex=0},showLastMsg:function(){var t=this;this.$nextTick((function(){t.scrollIntoView="last-msg-item",t.$nextTick((function(){t.scrollIntoView=""}))}))},clearAllMsg:function(t){var e=this;uni.showModal({title:"确认要清空聊天记录？",content:"本操作不可撤销",complete:function(t){t.confirm&&(e.closeSseChannel(),e.msgList.splice(0,e.msgList.length))}})},save:function(e){new Promise(function(){var n=(0,c.default)((0,r.default)().mark((function n(a,s){var o,c,d,l,u,f,p,v,h;return(0,r.default)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return e&&uni.showLoading({title:"保存中..."}),o=uni.getStorageSync("uni-ai-msg"),c=uni.getStorageSync("uni-id-pages-userInfo"),d=t.database(),l=d.command,u=o.map((function(t){return t.create_time})),n.next=8,d.collection("history").where({userId:c._id,create_time:l.in(u)}).get();case 8:if(f=n.sent,p=f.result.data.map((function(t){return t.create_time})),v=u.filter((function(t){return!p.includes(t)})),h=o.filter((function(t){return v.includes(t.create_time)})).map((function(t){return(0,i.default)((0,i.default)({},t),{},{userId:c._id})})),e&&(uni.hideLoading(),uni.showToast({title:"成功保存了".concat(h.length,"条记录")})),0!=h.length){n.next=15;break}return n.abrupt("return");case 15:return n.next=17,d.collection("history").add(h).then((function(t){}));case 17:n.sent;case 18:case"end":return n.stop()}}),n)})));return function(t,e){return n.apply(this,arguments)}}())}},onUnload:function(){console.log(968,"ouUnload"),this.save()}};e.default=h}).call(this,n("a9ff")["default"])},b25f:function(t,e,n){t.exports=n.p+"static/img/network.88a05d66.png"},b6cd:function(t,e,n){t.exports=n.p+"static/img/model.6a862932.png"}}]);